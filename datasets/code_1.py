# -*- coding: utf-8 -*-
"""code

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1dXPz-NucbXIO5eqFHh6lXrAGcS5tn-3b
"""

import os
import chardet
import codecs

def convert_txt_to_cp850(root_dir):
    '''
    Recursively converts all TXT files in the given directory and its subdirectories
    to CP850 encoding.

    Args:
        root_dir (str): The root directory to start the conversion from.
    '''

    for root, _, files in os.walk(root_dir):
        for filename in files:
            if filename.endswith('.txt'):
                filepath = os.path.join(root, filename)

                try:
                    # 1. Detect the current encoding
                    with open(filepath, 'rb') as f:
                        raw_data = f.read()
                        result = chardet.detect(raw_data)
                        source_encoding = result['encoding']

                    if source_encoding is None:
                        print(f'Skipping {filepath}: Unable to detect encoding.')
                        continue # Skip to the next file

                    # Handle cases where chardet returns "None" or other non-standard names
                    #if source_encoding.lower() == 'ascii':
                        #print(f'Skipping {filepath}: Already in ASCII (compatible with CP850).')
                        #continue


                    # 2. Read the file with the detected encoding
                    try:
                        with codecs.open(filepath, 'r', encoding=source_encoding, errors='replace') as f:
                            content = f.read()  # Read the content
                    except LookupError:
                        print(f'Skipping {filepath}: Unknown encoding "{source_encoding}".')
                        continue
                    except Exception as e:
                        print(f'Error reading {filepath} with encoding {source_encoding}: {e}')
                        continue


                    # 3. Write the content back to the file with UTF-8 encoding
                    try:
                        with codecs.open(filepath, 'w', encoding='cp850', errors='replace') as f:
                            f.write(content)
                    except Exception as e:
                         print(f'Error writing {filepath} in CP850: {e}')
                         continue


                    print(f'Converted {filepath} from {source_encoding} to CP850.')

                except Exception as e:
                    print(f'Error processing {filepath}: {e}')




# Example usage:
if __name__ == '__main__':
    # Replace 'path/to/your/directory' with the actual directory path
    directory_to_convert = '/Users/irinastareva/Desktop/Индивидуальный проект/tolkien-langdict/datasets'
    convert_txt_to_cp850(directory_to_convert)
    print('Conversion process completed.')
